{
    "contents" : "############################\n# V1_Nitrogen\n# Feeding study\n# Quentin Schorpp\n# 23.05.2015\n###########################\n\n\n# 1. Eathworm Biomass\n# arthworm biomass was measured in g after earthworm guts were voided. Mesurements took place before and after the experiment.\n# During the Experiment four Individual of L. terrestris died in Microcosms with the interaction Treatment in the 15N experimental part / approach.\n\n## Survival Rates: ####\nLt.Exp1  = 100*(1-4/(4*2*2*2)) # = 87.5 %\nLt.Exp2  = 100*(1-0/(3*2*2*2)) # = 100 %\nLt.total = 100*(1-4/((4*2*2*2)+(3*2*2*2))) # = 92.86 %\n# 100*(1-dead worms/all worms)\n\n# Data Exploration\nstr(ew.bm)\n\n# Ranges\nwith(ew.bm, list(length(before), range(before),range(after)))\nbs.worms1 = binsize1 = diff(range(ew.bm$before))/26\nbs.worms2 = binsize2 = diff(range(ew.bm$after))/26\nbs.worms3 = binsize3 = diff(range(ew.bm$diff))/length(ew.bm$diff)\n\n\n# Histograms Before/After\new.bm.melt = melt(ew.bm[,-c(7,8)], id.vars=c(1:4))\new.bm.p1 <- ggplot(ew.bm.melt, aes(x=value)) + \n  geom_histogram( binwidth = bs.worms1, fill=\"lightblue3\", colour=\"black\") + \n  geom_line(stat=\"density\") +\n  xlim(6.5,11) + \n  xlab(\"Biomass [g]\") +\n  ylab(\"Frequency\") +\n  ggtitle(\"Histograms EW-biomass \\n Before/After\") +\n  facet_grid(variable ~ .) + mytheme\n\n# normally distributed diferences?\new.bm.p2 <- ggplot(ew.bm, aes(x=diff)) +\n  geom_histogram(binwidth = bs.worms3, fill=\"lightblue3\", colour=\"black\") + \n  geom_line(stat=\"density\") + \n  xlab(\"differences [g]\") + \n  ylab(\"Frequency\") + \n  ggtitle(\"Histogram of differences\") + mytheme\n\n# One figure in row 1 and two figures in row 2\ngrid.newpage()\npushViewport(viewport(layout = grid.layout(1, 2)))\nprint(ew.bm.p1, vp = vplayout(1, 1))\nprint(ew.bm.p2, vp = vplayout(1, 2))\n```\n### Analysis\n``` {r Analysis1, echo=FALSE, fig.width=8, fig.height=7}\nshapiro.test(ew.bm$diff) # kann bei diesem Test eine Signifikanz (p < 0.05) festgestellt werden, so liegt keine Normalverteilung vor.\n\n\n#ggplot with qqnorm and qqline\nvec <- ew.bm$diff\ny <- quantile(vec[!is.na(vec)], c(0.25, 0.75))\nx <- qnorm(c(0.25, 0.75))\nslope <- diff(y)/diff(x)\nint <- y[1L] - slope * x[1L]\nd <- data.frame(resids = vec)\n\new.bm.p3 <- ggplot(d, aes(sample = resids)) + \n  stat_qq() + \n  geom_abline(slope = slope, intercept = int, col=\"red\") + \n  mytheme\n# Bland Altman plot\new.bm$diff.mean <- (ew.bm$after+ew.bm$before)/2\ndf2 <- ddply(ew.bm,.(rep(\"a\", length(diff))),summarise,mean=mean(diff, na.rm = TRUE),\n             sd=sd(diff, na.rm = TRUE))\new.bm.p4 <- ggplot(ew.bm, aes(diff.mean, diff)) + \n  geom_point(na.rm=TRUE) + \n  geom_hline(data=df2,aes(yintercept=c(round(mean,3),\n                                       round(mean+2*sd,3),\n                                       round(mean-2*sd,3))),\n             linetype=c(1,2,2), color='blue') +\n  mytheme\n\ngrid.newpage()\npushViewport(viewport(layout = grid.layout(1, 2)))\nprint(ew.bm.p3, vp = vplayout(1, 1))\nprint(ew.bm.p4, vp = vplayout(1, 2))\n\n\n# ew.bm.meth <- Meth(ew.bm[,c(5,6)], y=c(\"after\",\"before\")) # it was necessary, that no other variables from ew.bm are in the Meth object!!!\n# BA.plot(ew.bm.meth, axlim=c(8,10), diflim=c(-3,1))\n\n# t.test\n# with(ewfw, t.test(diff))\n# with(ew.bm, t.test(before, after, paired=T, alternative=\"greater\"))\nwith(ew.bm, t.test(after, before, paired=T, alternative=\"less\")) \n# Defining alt=\"less\", means check whether the mean of the values contained in the vector a is less of the mean of the values contained in the vector b (t.test(a,b,paired=TRUE, alt=\"less\"))\n\n\n# Were Changes in L. terrestris Biomass affected by Treatments?\nsummary(aov(diff ~ treat*soil*exp, data=ew.bm))\n# NO it was not.\n\nlist(mean(ew.bm$before),\n     se(ew.bm$before),\n     mean(ew.bm$after),\n     se(ew.bm$after))\n```\n\n\n\n#2. Collembolan Population growth\nCollembolans grew very well during the experiment and reached densities hardly observed in agricultural systems.\n\n##### Growth Factor\n```{r Collembolan population}\ncol.pop.initial = 238 #Ind/MC\ncol.pop.growth = col.pop$surface/238\ncol.pop$growth_f = col.pop.growth\n\nrange(col.pop.growth)\nmean(col.pop.growth); se(col.pop.growth)\n```\n\n\n```{r, Boxplots, fig.width=7, fig.height=6, echo=FALSE}\n# Boxplot Graphical Data Exploration\ncol.pop$exp <- revalue(col.pop$exp, c(Exp1=\"Experiment~1\",Exp2=\"Experiment~2\"))\ncol.pop$treat <- revalue(col.pop$treat, c(C =\"F.~candida\",RC=\"Interaction\"))\n\nggplot(col.pop, aes(x= treat, y=surface),labeller=label_parsed) +\n  stat_boxplot(geom=\"errorbar\", coef=1.5, lwd=0.2) + \n  geom_boxplot(fill=\"light blue\", lwd=0.2, outlier.size=0.4, outlier.shape=21) +\n  ylab(expression(paste(\"Collembolan density [Ind \",MC[surface]^-1,\"]\"))) +\n  xlab(\"Treatment\") +\n  ggtitle(expression(paste(\"Boxplots for collembolan density per \",MC[surface]))) +\n  facet_grid(exp~soil, labeller=label_parsed) + \n  scale_x_discrete(\"Treatment\", labels=expression(italic(F.~candida), Interaction)) +\n  mytheme\n````\n\nIn 3 out of 4 cases Presence of Lumbricus terrestris led to increased Collembolan population growth. The only exception is the loamy soil treatment in Exp1. Here the opposite was observed.\nFurthermore loamy soil treatments increased collembolan population growth in both experiments compared to sandy soil (`r tapply(col.pop$surface, col.pop$soil,mean)`, Loam, Sand).\nHypothesis: Low Nitrogen content of food material leads to decreased collembolan populations in loamy soil if L. terrestris is present.\n\n### Analysis of Collembolan populations\n```{r Analysis2}\n# Table of means\nwith(col.pop, tapply(surface, list(soil, treat, exp), mean))\n\n# Analysis of variance\ncp.lm1 <- lm(surface ~ treat*soil*exp, data=col.pop);cp.lm1; summary.aov(cp.lm1);summary.lm(cp.lm1)\ncp.lm2 <- lm(surface ~ treat*soil*exp-exp:treat:soil, data=col.pop);cp.lm2; summary.aov(cp.lm2);summary.lm(cp.lm2)\n# Soil and Experiment are significant in the main effects\n# Treatments is significant in interaction with soil and with experiment\n\n# The coefficients table of summary.lm has as many rows, as there are parameters in the model.The Intercept is the only mean value in the table. The second column contains the unreliability estimates. The firs ROW contains the standard error of a MEAN. The Other four rows contain the standard errors of  the DIFFERENCE between two means. The p-values are misleading, suggesting, wrongly, that there are four significant contrasts for this model.\n# All significant differences are differences to Exp1-Loam-F.candida\n\n# Effect Sizes of Main Effects\nplot.design(surface ~ soil*exp*treat-exp:treat:soil, data=col.pop)\n\n# The populations were larger in loamy soil\nwith(col.pop, tapply(surface, soil, mean))\nwith(col.pop, tapply(surface, soil, se))\n\n# The populations were larger in Experiment 2\nwith(col.pop, tapply(surface, exp, mean))\nwith(col.pop, tapply(surface, exp, se))\n\ncp.aov <- aov(surface ~ soil*exp*treat, data=col.pop)\n# ANOVA plots\npar(mfrow=c(2,2))\npar(mar=c(3,4,1.5,2), mgp=c(1.5,0.5,0))\nplot(cp.aov)\n# SST plot after Crawley (R-Book, p.)\npar(mfrow=c(1,1))\nwith(col.pop, { plot(surface, pch=21, col=\"black\",bg=\"red\")\n                abline(mean(surface),0, col=\"blue\")\n                title(\"SST\")\n                ylab=\"response (surface)\"\n                for (i in 1:28)\n                  lines(c(i,i), c(surface[i], mean(surface)), col=\"green\")\n})\nTukeyHSD(cp.aov)\n# Unterschiede zw. den treatments innerhalb desselben Experiments und derselben soil texture sind ALLE nicht significant!!!  \n\n# More Multiple Comparisons:\n# Variant 1:\ncol.pop.int <- cp.int <- with(col.pop, interaction(exp,soil,treat)) # Triple interaction factor\ncol.aov2 <- aov(surface ~ cp.int, data=col.pop)\nHSD.test(col.aov2, \"cp.int\", group=TRUE, console=TRUE)\n#Variant 2:  \ncol.tuk1 <- glht(col.aov2, linfct = mcp(cp.int = \"Tukey\"))\nsummary(col.tuk1)          # standard display\ncol.tuk.cld <- cld(col.tuk1)   # letter-based display\npar(mai=c(1,1,1.1,0.2),\n    mfrow=c(1,1),\n    mgp=c(2,1,0),\n    cex=0.8) # mai specifiec margin size in inches\nplot(col.tuk.cld, cex=0.5, las=2, col=\"grey\", xaxt=\"n\")\naxis(1, at=cp.int,labels=FALSE)\ntext(cp.int, labels=cp.int, par(\"usr\")[3], adj=c(1.2,1.2), xpd=TRUE, srt=45, cex=0.8)\n\n\n# Effect sizes of interactions\ncol.pop.effects <- allEffects(cp.lm2)\nplot(col.pop.effects, \"treat:soil\")\nplot(col.pop.effects, \"treat:exp\")\nplot(col.pop.effects, \"soil:exp\")\n\nmodel.tables(cp.aov, \"means\", se=TRUE)\nwith(col.pop, tapply(surface, list(treat,soil), mean))\nwith(col.pop, tapply(surface, list(treat,soil), se))\n\nwith(col.pop, tapply(surface, list(treat,exp), mean))\nwith(col.pop, tapply(surface, list(treat,exp), se))\n\nwith(col.pop, tapply(surface, list(soil,exp), mean))\nwith(col.pop, tapply(surface, list(soil,exp), se))\n\ncol.pop.effects <- allEffects(cp.lm1)\nplot(col.pop.effects, \"treat:soil:exp\")\n\n# Interessieren w?rde mich wie viel gr??er die Populationen im Schnitt in Anwesenheit von L. terrestris waren.\n# Datensatz zu differenzen zw. Interaktion und Single-Species Treatments\n# PROBLEM: Welche Mikrokosmen bilden Paare? \n# Bilden aller paarweise DIfferenzen und/oder nur f?r selbe Faktoren Kombination aus Exp und soil?\n# Wie subtrahiert man Standardfehler voneinander (gibt T-Test Aufschl?sse?)\n\n# Mein reduzierter Versuch:\ntreat.sand.exp1 = a = 9629 - 6319\ntreat.sand.exp2 = b = 18781 - 14766\ntreat.loam.exp2 = c = 11246 - 4487\ncp.diff.means = c(a,b,c)\nmean(cp.diff.means); se(cp.diff.means)\n\n```\n\n### Tukey HSD plots Two Way Interactions (optional)\n```{r More Tukey HSD, echo=FALSE, eval=FALSE}\ncp.int <- with(col.pop, interaction(treat, soil))\naov.col1 <- aov(surface ~ cp.int, data=col.pop)\nHSD.test(aov.col1, \"cp.int\", group=TRUE, console=TRUE)\ntuk <- glht(aov.col1, linfct = mcp(cp.int = \"Tukey\"))\nsummary(tuk)          # standard display\ntuk.cld <- cld(tuk)   # letter-based display\nopar <- par(mai=c(1,1,1.5,1))\nplot(tuk.cld, las=2)\npar(opar)\n\ncp.int <- with(col.pop, interaction(exp, soil))\naov.col1 <- aov(surface ~ cp.int, data=col.pop)\nHSD.test(aov.col1, \"cp.int\", group=TRUE, console=TRUE)\ntuk <- glht(aov.col1, linfct = mcp(cp.int = \"Tukey\"))\nsummary(tuk)          # standard display\ntuk.cld <- cld(tuk)   # letter-based display\nopar <- par(mai=c(1,1,1.5,1))\nplot(tuk.cld)\npar(opar)\n\ncp.int <- with(col.pop, interaction(exp, treat))\naov.col1 <- aov(surface ~ cp.int, data=col.pop)\nHSD.test(aov.col1, \"cp.int\", group=TRUE, console=TRUE)\ntuk <- glht(aov.col1, linfct = mcp(cp.int = \"Tukey\"))\nsummary(tuk)          # standard display\ntuk.cld <- cld(tuk)   # letter-based display\nopar <- par(mai=c(1,1,1.5,1))\nplot(tuk.cld)\npar(opar)\n```\n\n# Analysis of 15N enrichment in animal tissue\n## 15N enrichment in L. terrestris\n```{r 15N L. terrestris}\nbs4 <- diff(range(ew.iso$atpercent))/length(ew.iso$atpercent)\nggplot(ew.iso, aes(x=atpercent)) + \n  geom_histogram(binwidth = bs4 , fill=\"lightblue3\", colour=\"black\") + \n  xlab(expression(paste(.^15,\"N atom%\"))) + \n  ylab(\"frequency\") +\n  ggtitle(expression(paste(\"Histogram of\", .^15,\"N Enrichment in tissue of \",italic(L.~terrestris))))\n\n\n# Overlap between Loam and Sand in %\n100*((with(ew.iso[ew.iso$soil==\"S\",], max(atpercent)) - with(ew.iso[ew.iso$soil==\"L\",], min(atpercent)))/with(ew.iso,max(atpercent) - min(atpercent)))\n\nmaxRows <- by(ew.iso, ew.iso$soil, function(X) X[which.max(X$atpercent),])\nminRows <- by(ew.iso, ew.iso$soil, function(X) X[which.min(X$atpercent),])\ndo.call(\"rbind\", maxRows)\ndo.call(\"rbind\", minRows)\n\new.iso.plot <-  qplot(soil, atpercent, colour=treat, data=ew.iso) + \n  geom_point(size=2.5) +\n  annotate(\"text\", x=2,y=1.01+.02, label=\"max=1.01\", vjust=0, col=\"red\", size=4) +\n  annotate(\"text\", x=1,y=0.74+.02, label=\"min=0.74\", vjust=0,col=\"red\", size=4) +\n  xlab(\"Soiltype\") + \n  ylab(expression(paste(.^15,\"N atom%\",sep=\"\"))) + \n  ggtitle(expression(paste(\"Label in \",italic(\"L. terrestris\"))))+\n  scale_x_discrete(breaks=c(\"L\",\"S\"), labels=c(\"Loam\", \"Sand\"))+\n  labs(colour=\"Treatment\")+\n  scale_colour_discrete(labels=c(\"L.terrestris\", \"L. terrestris + F. candida\")) + \n  theme(panel.background= element_rect(fill=\"white\"),\n        panel.grid.major = element_line(colour=\"grey\"),\n        panel.grid.minor = element_line(colour=\"grey\", linetype=\"dashed\", size=0.2),\n        panel.border= element_rect(colour=\"black\", fill=NA, size=1),\n        axis.text = element_text(colour=\"black\", size=rel(1.3)),\n        axis.text.x = element_text(face=\"italic\"),\n        axis.title=element_text(size=rel(1.4)),\n        legend.text=element_text(face=\"italic\"))\new.iso.plot\n````\n\n# Analysis of 15N enrichment in L. terrestris\n```{r Analysis3}\n\nM.ew.iso <- lm(atpercent~treat*soil, data=ew.iso);anova(M.ew.iso);summary(M.ew.iso)\nM.ew.iso <- lm(atpercent~soil, data=ew.iso); anova(M.ew.iso);summary(M.ew.iso)\nlm.influence(M.ew.iso)\ninfluence.measures(M.ew.iso)$is.inf\n\npar(mfrow=c(2,2),\n    mar=c(3,3,3,3))\nplot(M.ew.iso)\n\nshapiro.test(ew.iso$atpercent)\nfligner.test(atpercent~soil, data=ew.iso)\n\nt.test(atpercent~soil, ew.iso)\nt.test(atpercent~soil,ew.iso, alternative=\"greater\")\n\nwith(ew.iso, list( tapply(atpercent, soil, mean),\n                   tapply(atpercent, soil, se)))\n```\nL. terrestris was significantly more enriched in loamy soil, compared to sandy soil 15N in tissue was with 1.04 +/- 0.08 atom% greater than  0.75 +/- 0.08 in sandy soil.\n\n## 15N enrichment in F.candida\n```{r 15N F. candida}\n#Histograms\npar(mfrow=c(2,1))\nhist(col.iso$atpercent)\nhist(col.iso$atpercent, main=\"breaks=12\", breaks=12) # Too narrow --> breaks in Histogram\n\nlist(range(col.iso$atpercent),\n     range(col.iso$atpercent)[2] -\n       range(col.iso$atpercent)[1])\n\n#There's a differnce between the Minima and Maxima of 0.896 atom percent\n# what differnce in atpercent is meaningful?\n\nwith(col.iso, list(median(atpercent),\n                   mean(atpercent))) # median and mean are the same: 6.4 atom percent\n\nicept = median(col.iso$atpercent)\n\ncol.iso.plot <- \n  qplot(soil, atpercent, colour=treat, data=col.iso) + \n  geom_point(size=2.5) + \n  geom_hline(yintercept=icept, linetype=\"dashed\", colour=\"red\") +\n  annotate(\"text\", label=\"Midline Max(Loam) - Min(Sand) y=6.4\", x=1.5, y=6.44, size=4,colour=\"red\") +\n  ggtitle(expression(paste(\"Label in \",italic(\"F. candida\"))))+  \n  xlab(\"soiltexture\") + \n  ylab(expression(paste(.^15,\"N atom%\",sep=\"\"))) + \n  scale_x_discrete(breaks=c(\"L\",\"S\"), labels=c(\"Loam\", \"Sand\"))+\n  scale_colour_discrete(labels=c(\"F.candida\", \"F. candida \\n + L. terrestris\")) + \n  labs(colour=\"Treatment\")+\n  theme(panel.background= element_rect(fill=\"white\"),\n        panel.grid.major = element_line(colour=\"grey\"),\n        panel.grid.minor = element_line(colour=\"grey\", linetype=\"dashed\", size=0.2),\n        panel.border= element_rect(colour=\"black\", fill=NA, size=1),\n        axis.text = element_text(colour=\"black\", size=rel(1.3)),\n        axis.text.x = element_text(face=\"italic\"),\n        axis.title=element_text(size=rel(1.4)),\n        legend.text=element_text(face=\"italic\"))\ncol.iso.plot\n````\n\n```{r Analysis4}\nM.col.iso1 <- with(col.iso, aov(atpercent~treat*soil)); summary(M.col.iso1)\nM.col.iso2 <- with(col.iso, aov(atpercent~soil)); summary(M.col.iso2)\n# What other nutritional source could F. candida have had in Loam?\n\nanova(M.col.iso1, M.col.iso2)\nAIC(M.col.iso1, M.col.iso2)\n\nM.col.iso3 <- lm(atpercent~soil, data=col.iso)\nlm.influence(M.col.iso3)\ninfluence.measures(M.col.iso3)$is.inf\n\nt.test(atpercent~soil, col.iso, alternative=\"less\")\n\nwith(col.iso, list( tapply(atpercent, soil, mean),\n                    tapply(atpercent, soil, se)))\n\nmean(col.iso$atpercent)\nse(col.iso$atpercent)\n\n```\n\n```{r Figure 15N Enrichment}\norganism <- factor(rep(c(\"italic(L.~terrestris)\", \"italic(F.~candida)\"), each=12), levels=c(\"italic(L.~terrestris)\", \"italic(F.~candida)\"))\new.col.iso <- rbind(ew.iso, col.iso)\new.col.iso$organism <- organism\new.col.iso$soil <- revalue(ew.col.iso$soil, c(L=\"Loam\", S=\"Sand\"))\n\n#long cut way to find number of facets\nlen <- length(levels(ew.col.iso$organism))# *  length(levels(mtcars$am))\nvars <- data.frame(organism=levels(ew.col.iso$organism))\ny = with(ew.col.iso, tapply(atpercent,organism,max)-0.025)\ndat <- data.frame(x = rep(0.5, len), y = y, vars, labs=LETTERS[1:len])\n\nggplot(ew.col.iso, aes(x=soil, y=atpercent), family=\"Arial\") + \n  stat_boxplot(geom=\"errorbar\", coef=1.5, lwd=0.2) + \n  geom_boxplot(fill=\"grey\", lwd=0.2, outlier.size=0.4, outlier.shape=21) +  \n  facet_grid(organism ~ . , scales=\"free\", space=\"free\",labeller=label_parsed) + \n  ylab(\"atom %\") + \n  xlab(\"soil texture\") + \n  geom_text(aes(x, y, label=labs, group=NULL),data=dat) +\n  # ggtitle(expression(paste(.^15,\"N enrichment in animal tissue\"))) +\n  mytheme\n\n\n\n#setwd(\"D:/Quentin Schorpp/Schreibtisch/2 - Laborversuche/Mikrokosmen/Manuskript/Entwurf\")\n#ggsave(\"Figure1.pdf\", width=9, height=7, units=\"cm\", useDingbats=FALSE) \n#embed_fonts(\"Figure1.pdf\", outfile=\"Figure1.pdf\")\n#ggsave(\"Figure1.svg\", width=9, height=7, units=\"cm\") \n```\n",
    "created" : 1432393230093.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3027496667",
    "id" : "FA0BC9EE",
    "lastKnownWriteTime" : 1432393464,
    "path" : "D:/Quentin_Schorpp/Arbeitsprozess/git_repositories/V1_Nitrogen/Analysis/V1_FeedingStudy.R",
    "project_path" : "Analysis/V1_FeedingStudy.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "source_on_save" : false,
    "type" : "r_source"
}